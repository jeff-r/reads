<p id="notice"><%= notice %></p>

<div id='feed_header'>
	<p>
		<a href='<%= @feed.url %>'><%= @feed.title %></a>: <%= @feed.feed_items.count %> items.
		Last updated: <%= time_ago_in_words(@feed.updated_at) %> ago.
		</p>
	<p><%= link_to 'Refresh the feed', refresh_path(@feed) %>
--		<%= link_to 'Delete all feed items', delete_all_items_path(@feed) %>
		
		 </p>
	<p>Most recent item time: <%= @feed.most_recent_item_time %></p>
	
</div>

<% if @feed.feed_items.count == 0 %>
	<p>No items in the feed. Sorry.</p>
<% else %>
	<p>Num items: <%= @feed.feed_items.count.to_s %></p>

	<% @feed.feed_items.each do |item| %>
	<% itemclass = 'item' %>
	<% if item.read %>
		<% itemclass = 'item already_read' %>
	<% end %>
		
	<div class="<%= itemclass %>">
    <div class='item_title'>
      <a target="_blank" href="<%= item.link %>"><%= item.title %></a>
      <% if item.has_sub_items? %>
      <div class='subitemslink'>
        <%= link_to "#{item.num_threadentries} entries", subfeed_path(@feed, item)  %> 
      </div>
      <% end %>
    </div>
		<div class='item_description'><%= item.description.html_safe if not item.description.nil? %></div>
    <p><%= "Posted #{time_ago_in_words(item.pub_date)} ago" %></p>
		<div class='item_actions'>

			<%= form_tag(:feed_item, :method=>'put') do %>
			<%= hidden_field_tag(:read_item_id, item.id) %>
			<%= submit_tag 'Mark as read', :class=>'mark_as_read_button', "data-itemid"=>item.id %>
			<% end %>
		</div>
	</div>
	<% end %>
<% end %>


<%= link_to 'Edit', edit_feed_path(@feed) %> |
<%= link_to 'Delete feed', url_for(:controller=>:feeds, :id=>@feed.id, :action=>'destroy'), :method=>'delete' %>
